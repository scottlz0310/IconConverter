# 実装タスクリスト: WebUI移行

## タスク概要

このタスクリストは、TkinterデスクトップアプリケーションからモダンなWebアプリケーションへの移行を段階的に実装するためのものです。各タスクは独立して実装可能で、前のタスクの成果物を基に構築されます。

---

## フェーズ1: プロジェクト基盤構築

- [x] 1. プロジェクト構造のセットアップ
  - 新しいディレクトリ構造を作成（backend/, frontend/）
  - 既存のiconconverterパッケージをbackend/coreに移動
  - .gitignoreの更新（node_modules, dist, .env等）
  - _要件: 1.1, 1.2, 1.3_

- [x] 2. バックエンドプロジェクトの初期化
  - [x] 2.1 FastAPIプロジェクトのセットアップ
    - backend/pyproject.tomlの作成（FastAPI, uvicorn, python-multipart等の依存関係）
    - backend/main.pyの作成（FastAPIアプリケーションインスタンス）
    - CORS設定の追加
    - _要件: 1.1, 7.4_
  - [x] 2.2 既存ロジックの統合
    - backend/core/にiconconverter（logic.py, utils.py, config.py）をコピー
    - インポートパスの調整
    - 既存ロジックが正常に動作することを確認
    - _要件: 1.4_
  - [x] 2.3 Pydanticモデルの作成
    - backend/models.pyの作成
    - ConversionRequest, HealthResponse, ErrorResponseモデルの実装
    - _要件: 1.1_

- [x] 3. フロントエンドプロジェクトの初期化
  - [x] 3.1 Vite + React + TypeScriptプロジェクトの作成
    - `pnpm create vite frontend --template react-ts`
    - 基本的な依存関係のインストール（React, TypeScript）
    - _要件: 1.2_
  - [x] 3.2 開発ツールとリンターのセットアップ
    - ESLint, Prettierの設定
    - Tailwind CSSのインストールと設定
    - _要件: 1.2_
  - [x] 3.3 shadcn/uiのセットアップ
    - shadcn/ui CLIのインストール
    - 基本コンポーネント（Button, Card, Checkbox等）の追加
    - _要件: 6.1, 6.2_

---

## フェーズ2: バックエンドAPI実装

- [x] 4. バリデーションサービスの実装
  - [x] 4.1 ファイルバリデーション関数の作成
    - backend/services/validation.pyの作成
    - ファイル形式検証（MIME type, 拡張子, Pillow検証）
    - ファイルサイズ検証（10MB制限）
    - _要件: 7.1, 7.2_
  - [x] 4.2 カスタム例外クラスの作成
    - backend/exceptions.pyの作成
    - InvalidFileFormatError, FileSizeExceededError等の定義
    - _要件: 4.5_

- [x] 5. 画像変換サービスの実装
  - [x] 5.1 ImageConversionServiceクラスの作成
    - backend/services/conversion.pyの作成
    - 既存のIconConverterクラスをラップ
    - 一時ファイル管理（作成・削除）
    - _要件: 4.2, 7.5_
  - [x] 5.2 非同期変換処理の実装
    - asyncioを使用した非同期処理
    - エラーハンドリングとログ記録
    - _要件: 4.2, 8.2, 8.3, 10.4_

- [x] 6. FastAPI エンドポイントの実装
  - [x] 6.1 /api/convert エンドポイントの実装
    - backend/routers/convert.pyの作成
    - multipart/form-dataの受信処理
    - ValidationServiceによるバリデーション
    - ImageConversionServiceによる変換
    - StreamingResponseでICOファイルを返却
    - _要件: 4.1, 4.2, 4.3, 4.4_
  - [x] 6.2 /api/health エンドポイントの実装
    - backend/routers/health.pyの作成
    - ヘルスチェックレスポンスの返却
    - _要件: 8.5_
  - [x] 6.3 エラーハンドラーの実装
    - backend/main.pyにカスタム例外ハンドラーを追加
    - 適切なHTTPステータスコードとエラーメッセージ
    - _要件: 4.5_

- [x] 7. セキュリティとミドルウェアの実装
  - [x] 7.1 レート制限の追加
    - slowapiライブラリの統合
    - /api/convertエンドポイントに10req/minの制限
    - _要件: 7.3_
  - [x] 7.2 ロギングミドルウェアの追加
    - リクエストID生成とログ記録
    - 構造化ログ（JSON形式）
    - _要件: 8.1, 8.2, 8.4_

---

## フェーズ3: フロントエンド基盤実装

- [x] 8. TypeScript型定義とAPIクライアントの作成
  - [x] 8.1 型定義ファイルの作成
    - frontend/src/types/index.tsの作成
    - ImageFile, ConversionOptions, AppState等の型定義
    - _要件: 1.2_
  - [x] 8.2 APIクライアントの実装
    - frontend/src/services/api.tsの作成
    - axiosインスタンスの設定
    - convertImage関数の実装
    - エラーハンドリング
    - _要件: 4.1, 4.5_

- [x] 9. 状態管理の実装
  - [x] 9.1 Zustandストアの作成
    - frontend/src/stores/imageStore.tsの作成
    - AppState型に基づくストア実装
    - 画像、オプション、ステータス、エラーの管理
    - _要件: 2.1, 3.1, 4.1_
  - [x] 9.2 TanStack Queryのセットアップ
    - QueryClientの設定
    - useImageConversionカスタムフックの作成
    - _要件: 4.1, 5.1_

- [x] 10. 基本UIコンポーネントの実装
  - [x] 10.1 レイアウトコンポーネントの作成
    - frontend/src/components/Layout.tsxの作成
    - ヘッダー、メインコンテンツエリア、フッター
    - レスポンシブデザイン
    - _要件: 6.1_
  - [x] 10.2 ThemeToggleコンポーネントの作成
    - frontend/src/components/ThemeToggle.tsxの作成
    - ダークモード切替機能
    - useThemeカスタムフック
    - _要件: 6.5_

---

## フェーズ4: コア機能実装

- [x] 11. ファイルアップロード機能の実装
  - [x] 11.1 FileUploaderコンポーネントの作成
    - frontend/src/components/FileUploader.tsxの作成
    - react-dropzoneの統合
    - ドラッグ&ドロップエリアのUI
    - ファイル選択ボタン
    - _要件: 2.1, 2.2_
  - [x] 11.2 クライアントサイドバリデーションの実装
    - ファイル形式チェック（PNG, JPEG, BMP, GIF, TIFF, WebP）
    - ファイルサイズチェック（10MB）
    - エラーメッセージ表示
    - _要件: 2.3, 2.5_
  - [x] 11.3 ファイル選択時の処理
    - Data URLの生成（プレビュー用）
    - Zustandストアへの保存
    - _要件: 2.4_

- [x] 12. 画像プレビュー機能の実装
  - [x] 12.1 ImagePreviewコンポーネントの作成
    - frontend/src/components/ImagePreview.tsxの作成
    - 画像表示エリア
    - 画像情報（ファイル名、サイズ、形式）の表示
    - _要件: 2.4_
  - [x] 12.2 画像削除機能の実装
    - 削除ボタンの追加
    - ストアのリセット
    - プレビューのクリア
    - _要件: 2.4_

- [x] 13. 変換オプションUIの実装
  - [x] 13.1 ConversionOptionsコンポーネントの作成
    - frontend/src/components/ConversionOptions.tsxの作成
    - 透明化保持チェックボックス
    - 自動背景透明化チェックボックス
    - _要件: 3.1, 3.2_
  - [x] 13.2 相互排他制御の実装
    - チェックボックスの相互排他ロジック
    - デフォルト値の設定（透明化保持=true）
    - _要件: 3.3, 3.4, 3.5_

- [x] 14. 画像変換とダウンロード機能の実装
  - [x] 14.1 変換ボタンとロジックの実装
    - 変換ボタンコンポーネント
    - useImageConversionフックの使用
    - API呼び出しとレスポンス処理
    - _要件: 4.1, 4.2, 4.3_
  - [x] 14.2 ファイルダウンロード処理の実装
    - Blobからダウンロードリンクの生成
    - 自動ダウンロードのトリガー
    - ファイル名の設定（元のファイル名.ico）
    - _要件: 4.4_
  - [x] 14.3 エラーハンドリングの実装
    - APIエラーのキャッチ
    - エラーメッセージの表示（トースト）
    - ストアのエラー状態更新
    - _要件: 4.5_

---

## フェーズ5: UX向上

- [x] 15. プログレス表示の実装
  - [x] 15.1 ConversionProgressコンポーネントの作成
    - frontend/src/components/ConversionProgress.tsxの作成
    - ローディングスピナー
    - プログレスバー
    - ステータスメッセージ
    - _要件: 5.1, 5.2_
  - [x] 15.2 状態に応じた表示制御
    - idle, uploading, converting, success, errorの各状態
    - 適切なUIの表示/非表示
    - _要件: 5.3, 5.4, 5.5_

- [x] 16. トースト通知の実装
  - [x] 16.1 Toastコンポーネントの統合
    - shadcn/ui Toastの追加
    - Toasterコンポーネントの配置
    - _要件: 5.4_
  - [x] 16.2 通知トリガーの実装
    - 成功時の通知
    - エラー時の通知
    - 情報メッセージの通知
    - _要件: 5.3, 5.4_

- [x] 17. レスポンシブデザインの実装
  - [x] 17.1 モバイル対応レイアウト
    - Tailwind CSSのブレークポイント使用
    - モバイル、タブレット、デスクトップの各レイアウト
    - _要件: 6.1_
  - [x] 17.2 タッチ操作の最適化
    - タッチターゲットサイズの調整
    - スワイプジェスチャーの考慮
    - _要件: 6.1_

- [x] 18. アクセシビリティの実装
  - [x] 18.1 キーボードナビゲーション
    - フォーカス管理
    - Tabキーでの移動
    - Enterキーでのアクション実行
    - _要件: 6.4_
  - [x] 18.2 ARIAラベルとセマンティックHTML
    - 適切なARIA属性の追加
    - セマンティックHTMLタグの使用
    - スクリーンリーダー対応
    - _要件: 6.3_

---

## フェーズ6: Docker化とデプロイメント

- [x] 19. Docker設定の作成
  - [x] 19.1 バックエンドDockerfileの作成
    - backend/Dockerfileの作成
    - uvを使用した依存関係インストール
    - uvicornでの起動設定
    - _要件: 9.1_
  - [x] 19.2 フロントエンドDockerfileの作成
    - frontend/Dockerfileの作成
    - マルチステージビルド（builder + nginx）
    - 本番ビルドの最適化
    - _要件: 9.1_
  - [x] 19.3 docker-compose.ymlの作成
    - 開発環境用のdocker-compose設定
    - バックエンド、フロントエンド、nginxサービス
    - ボリュームマウントとホットリロード設定
    - _要件: 9.2_

- [X] 20. 環境変数とコンフィグの整備
  - [X] 20.1 バックエンド環境変数の設定
    - backend/.env.exampleの作成
    - LOG_LEVEL, MAX_FILE_SIZE, CORS_ORIGINS等
    - _要件: 9.2_
  - [X] 20.2 フロントエンド環境変数の設定
    - frontend/.env.exampleの作成
    - VITE_API_URL, VITE_MAX_FILE_SIZE等
    - _要件: 9.2_

- [x] 21. Makefileの更新
  - 開発環境起動コマンド（make dev）
  - 本番ビルドコマンド（make build）
  - Dockerコンテナ管理コマンド
  - _要件: 9.5_

---

## フェーズ7: テストとドキュメント

- [x] 22. バックエンドテストの作成
  - [x] 22.1 ユニットテストの作成
    - ValidationServiceのテスト
    - ImageConversionServiceのテスト
    - _要件: 4.2_
  - [x] 22.2 APIエンドポイントテストの作成
    - /api/convertエンドポイントのテスト
    - /api/healthエンドポイントのテスト
    - エラーケースのテスト
    - _要件: 4.1, 4.5_

- [x] 23. フロントエンドテストの作成
  - [x] 23.1 コンポーネントテストの作成
    - React Testing Libraryを使用
    - 主要コンポーネントのテスト
    - _要件: 2.1, 3.1, 4.1_
  - [x] 23.2 E2Eテストの作成
    - Playwrightのセットアップ
    - 完全な変換フローのテスト
    - クロスブラウザテスト
    - _要件: 6.2_

- [x] 24. ドキュメントの作成
  - [x] 24.1 README.mdの更新
    - WebUIアプリケーションの説明
    - セットアップ手順
    - 使用方法
    - _要件: 9.2_
  - [x] 24.2 API仕様書の作成
    - FastAPIの自動生成ドキュメント（/docs）の確認
    - 追加のAPI仕様書作成（必要に応じて）
    - _要件: 1.1_
  - [x] 24.3 アーキテクチャドキュメントの作成
    - システム構成図
    - データフロー図
    - デプロイメント手順
    - _要件: 1.1_

---

## フェーズ8: パフォーマンス最適化と最終調整

- [x] 25. パフォーマンス最適化
  - [x] 25.1 バックエンド最適化
    - 非同期処理の最適化
    - メモリ使用量の削減
    - レスポンスタイムの測定と改善
    - _要件: 10.1, 10.4_
  - [x] 25.2 フロントエンド最適化
    - コード分割の実装（React.lazy）
    - バンドルサイズの削減
    - 画像プレビューの最適化
    - _要件: 10.2, 10.3, 10.5_
  - [x] 25.3 パフォーマンステストの実施
    - Lighthouseスコアの測定
    - 変換処理時間の測定
    - 目標値との比較（初回ロード3秒以内、変換5秒以内）
    - _要件: 10.1, 10.2_

- [x] 26. セキュリティ監査
  - [x] 26.1 依存関係の脆弱性スキャン
    - uvでのsafetyチェック
    - npmでのauditチェック
    - _要件: 7.1, 7.2, 7.3_
  - [x] 26.2 セキュリティベストプラクティスの確認
    - OWASP Top 10のチェック
    - ファイルアップロードセキュリティの再確認
    - _要件: 7.1, 7.2, 7.3, 7.4, 7.5_

- [x] 27. 最終調整とポリッシュ
  - [x] 27.1 UIの微調整
    - スペーシング、カラー、タイポグラフィの調整
    - アニメーションの追加
    - _要件: 6.1_
  - [x] 27.2 エラーメッセージの改善
    - ユーザーフレンドリーなメッセージ
    - 多言語対応の準備（必要に応じて）
    - _要件: 4.5, 5.4_
  - [x] 27.3 最終動作確認
    - 全機能の手動テスト
    - クロスブラウザテスト
    - モバイルデバイステスト
    - _要件: 6.1, 6.2_

---

## フェーズ9: 品質保証と最終検証

- [x] 28. コード品質の最適化
  - [x] 28.1 バックエンドコード品質の向上
    - ruffによるリント警告の解消
    - コードフォーマットの統一（ruff format）
    - 未使用インポートと変数の削除
    - _要件: 1.1_
  - [x] 28.2 フロントエンドコード品質の向上
    - ESLintエラーと警告の解消
    - Prettierによるフォーマット統一
    - 未使用変数とインポートの削除
    - _要件: 1.2_

- [x] 29. 型チェックの完全通過
  - [x] 29.1 バックエンド型チェック
    - mypyによる型チェックエラーの解消
    - 全ての関数に型ヒントを追加
    - Pydanticモデルの型安全性確認
    - _要件: 1.1_
  - [x] 29.2 フロントエンド型チェック
    - TypeScriptコンパイルエラーの解消
    - any型の使用を最小化
    - 全てのコンポーネントとフックに適切な型定義
    - _要件: 1.2_

- [x] 30. テストカバレッジ80%の達成
  - [x] 30.1 バックエンドカバレッジ向上
    - pytest-covでカバレッジ測定
    - 未カバーのコードパスを特定
    - 不足しているテストケースを追加
    - カバレッジレポートの生成と確認
    - _要件: 4.2, 7.1, 7.2_
  - [x] 30.2 フロントエンドカバレッジ向上
    - Vitestカバレッジ測定
    - 未カバーのコンポーネントとフックを特定
    - 不足しているテストケースを追加
    - カバレッジレポートの生成と確認
    - _要件: 2.1, 3.1, 4.1_

- [x] 31. 全テストの成功確認
  - [x] 31.1 バックエンドテストの実行と修正
    - 全てのユニットテストを実行
    - 全てのAPIテストを実行
    - 失敗しているテストを特定して修正
    - CI環境でのテスト成功を確認
    - _要件: 4.1, 4.2, 4.5_
  - [x] 31.2 フロントエンドテストの実行と修正
    - 全てのコンポーネントテストを実行
    - 全てのE2Eテストを実行
    - 失敗しているテストを特定して修正
    - クロスブラウザテストの成功を確認
    - _要件: 2.1, 3.1, 4.1, 6.2_

- [ ] 32. 最終品質検証
  - [ ] 32.1 統合品質チェック
    - 全てのリントツールを実行（エラー0）
    - 全ての型チェックを実行（エラー0）
    - 全てのテストを実行（失敗0）
    - カバレッジ目標80%以上を確認
    - _要件: 1.1, 1.2_
  - [ ] 32.2 品質メトリクスの記録
    - テストカバレッジレポートの保存
    - パフォーマンステスト結果の記録
    - セキュリティスキャン結果の記録
    - 品質ダッシュボードの作成（必要に応じて）
    - _要件: 10.1, 10.2_

---

## 注意事項

- 各タスクは前のタスクの完了を前提としています
- 実装中に設計の見直しが必要な場合は、design.mdを更新してください
- 各フェーズ完了後に動作確認を行ってください
- フェーズ9の品質保証タスクは、全ての実装完了後に実施してください
