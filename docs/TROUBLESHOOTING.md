# IconConverter トラブルシューティングガイド

## 目次

1. [インストール関連](#インストール関連)
2. [起動関連](#起動関連)
3. [変換エラー](#変換エラー)
4. [パフォーマンス問題](#パフォーマンス問題)
5. [ファイル関連付け](#ファイル関連付け)
6. [自動更新](#自動更新)
7. [システムトレイ](#システムトレイ)
8. [ログとデバッグ](#ログとデバッグ)
9. [既知の問題](#既知の問題)

---

## インストール関連

### Windows

#### 問題: インストーラーが起動しない

**症状**:

- インストーラーをダブルクリックしても何も起こらない
- エラーメッセージが表示されない

**原因**:

- ダウンロードが不完全
- ファイルが破損
- ウイルス対策ソフトによるブロック

**解決方法**:

1. **ファイルの再ダウンロード**

   ```powershell
   # チェックサムを確認
   Get-FileHash IconConverter-Setup-1.0.0.exe -Algorithm SHA256
   ```

   公式チェックサムと一致するか確認

2. **ウイルス対策ソフトの確認**
   - Windows Defenderの履歴を確認
   - 一時的に無効化して再試行（非推奨）
   - または、除外設定に追加

3. **管理者として実行**
   - インストーラーを右クリック
   - 「管理者として実行」を選択

#### 問題: 「このアプリはお使いのPCでは実行できません」

**症状**:

- インストーラー起動時にエラーメッセージが表示される

**原因**:

- 32-bit Windowsを使用している
- Windows 7以前のOSを使用している

**解決方法**:

- Windows 10 64-bit以降にアップグレード
- または、WebUI版を使用

#### 問題: インストール中にエラーが発生

**症状**:

- インストール途中で停止
- 「インストールに失敗しました」と表示される

**原因**:

- ディスク容量不足
- 既存のインストールが残っている
- 権限不足

**解決方法**:

1. **ディスク容量の確認**
   - 最低500MBの空き容量が必要
   - ディスククリーンアップを実行

2. **既存インストールの削除**

   ```
   コントロールパネル
   → プログラムと機能
   → IconConverter（あれば）
   → アンインストール
   ```

3. **一時ファイルの削除**

   ```
   %TEMP%\IconConverter-*
   ```

   このフォルダを削除

### macOS

#### 問題: 「開発元を確認できないため開けません」

**症状**:

- DMGファイルまたはアプリを開こうとするとエラーが表示される

**原因**:

- Gatekeeperのセキュリティ設定

**解決方法**:

**方法1: システム環境設定から許可**

```
システム環境設定
→ セキュリティとプライバシー
→ 一般タブ
→ 「このまま開く」ボタンをクリック
```

**方法2: Controlキーを使用**

```
Applicationsフォルダで IconConverter を探す
→ Controlキーを押しながらクリック
→ 「開く」を選択
→ 確認ダイアログで「開く」をクリック
```

**方法3: ターミナルから隔離属性を削除**

```bash
xattr -cr /Applications/IconConverter.app
```

#### 問題: 「破損しているため開けません」

**症状**:

- アプリを開こうとすると「破損している」と表示される

**原因**:

- ダウンロードが不完全
- 隔離属性の問題

**解決方法**:

1. **隔離属性の削除**

   ```bash
   xattr -cr /Applications/IconConverter.app
   ```

2. **再ダウンロード**
   - ブラウザのキャッシュをクリア
   - DMGファイルを再ダウンロード
   - チェックサムを確認:

     ```bash
     shasum -a 256 IconConverter-1.0.0.dmg
     ```

3. **Gatekeeperの一時的な無効化**（非推奨）

   ```bash
   sudo spctl --master-disable
   # アプリを起動後、再度有効化
   sudo spctl --master-enable
   ```

#### 問題: Apple Silicon Macで動作が遅い

**症状**:

- アプリの起動や動作が遅い
- CPUファンが回る

**原因**:

- Intel版（x64）をRosetta 2で実行している

**解決方法**:

- Apple Silicon版（arm64）をダウンロード
- `IconConverter-x.x.x-arm64.dmg`を使用

### Linux

#### 問題: AppImageが起動しない

**症状**:

- AppImageをダブルクリックしても何も起こらない
- ターミナルから実行するとエラーが表示される

**原因**:

- 実行権限がない
- FUSEがインストールされていない

**解決方法**:

1. **実行権限の付与**

   ```bash
   chmod +x IconConverter-1.0.0.AppImage
   ```

2. **FUSEのインストール**

   ```bash
   # Ubuntu/Debian
   sudo apt-get install fuse libfuse2

   # Fedora
   sudo dnf install fuse fuse-libs

   # Arch Linux
   sudo pacman -S fuse2
   ```

3. **ターミナルから実行してエラーを確認**

   ```bash
   ./IconConverter-1.0.0.AppImage
   ```

#### 問題: DEBパッケージのインストールエラー

**症状**:

- `dpkg: dependency problems`エラーが表示される

**原因**:

- 依存関係が満たされていない

**解決方法**:

1. **依存関係の自動解決**

   ```bash
   sudo apt-get install -f
   ```

2. **手動で依存関係をインストール**

   ```bash
   sudo apt-get install libgtk-3-0 libnotify4 libnss3 libxss1 libxtst6 xdg-utils libatspi2.0-0 libdrm2 libgbm1 libxcb-dri3-0
   ```

3. **再インストール**

   ```bash
   sudo dpkg -i iconconverter_1.0.0_amd64.deb
   ```

#### 問題: 「libfuse.so.2: cannot open shared object file」

**症状**:

- AppImage実行時にエラーが表示される

**原因**:

- FUSE 2がインストールされていない

**解決方法**:

```bash
# Ubuntu 22.04以降
sudo apt-get install libfuse2

# Fedora
sudo dnf install fuse-libs

# Arch Linux
sudo pacman -S fuse2
```

---

## 起動関連

### 問題: アプリケーションが起動しない

#### Windows

**症状**:

- ダブルクリックしても何も起こらない
- すぐに終了する

**解決方法**:

1. **Visual C++ Redistributableのインストール**
   - [Microsoft公式サイト](https://aka.ms/vs/17/release/vc_redist.x64.exe)からダウンロード
   - インストール後、PCを再起動

2. **イベントビューアーでエラーを確認**

   ```
   Windowsキー + X
   → イベントビューアー
   → Windowsログ
   → アプリケーション
   → IconConverterのエラーを探す
   ```

3. **クリーンインストール**
   - アンインストール
   - `%AppData%\IconConverter`フォルダを削除
   - 再インストール

#### macOS

**症状**:

- アプリが起動しない、またはすぐに終了する

**解決方法**:

1. **コンソールアプリでログを確認**

   ```
   アプリケーション
   → ユーティリティ
   → コンソール
   → IconConverterのログを検索
   ```

2. **権限の修正**

   ```bash
   sudo chown -R $(whoami) /Applications/IconConverter.app
   chmod -R 755 /Applications/IconConverter.app
   ```

3. **設定ファイルの削除**

   ```bash
   rm -rf ~/Library/Application\ Support/IconConverter
   rm -rf ~/Library/Preferences/com.iconconverter.app.plist
   ```

#### Linux

**症状**:

- アプリが起動しない

**解決方法**:

1. **ターミナルから実行してエラーを確認**

   ```bash
   iconconverter
   # または
   ./IconConverter-1.0.0.AppImage
   ```

2. **依存関係の確認**

   ```bash
   ldd /usr/bin/iconconverter
   # または
   ldd IconConverter-1.0.0.AppImage
   ```

   `not found`と表示されるライブラリをインストール

3. **設定ファイルの削除**

   ```bash
   rm -rf ~/.config/IconConverter
   rm -rf ~/.local/share/IconConverter
   ```

### 問題: 起動が遅い

**症状**:

- アプリの起動に10秒以上かかる

**原因**:

- ディスクI/Oが遅い
- ウイルス対策ソフトのスキャン
- 大量の設定ファイル

**解決方法**:

1. **ウイルス対策ソフトの除外設定**
   - IconConverterのインストールフォルダを除外リストに追加

2. **設定ファイルのクリーンアップ**
   - 設定をリセット（設定 → 一般 → 設定をリセット）

3. **SSDへの移行**
   - HDDからSSDに移行すると起動が高速化

---

## 変換エラー

### 問題: 「ファイルが大きすぎます」

**症状**:

- 画像を選択すると「ファイルが大きすぎます」と表示される

**原因**:

- ファイルサイズが10MBを超えている

**解決方法**:

1. **画像を縮小**
   - 画像編集ソフトで解像度を下げる
   - 推奨: 1024×1024以下

2. **画像を圧縮**
   - PNG: TinyPNG、OptiPNGなどで圧縮
   - JPEG: 品質を下げる（80-90%推奨）

3. **形式を変換**
   - BMP → PNG
   - TIFF → JPEG

### 問題: 「対応していない形式です」

**症状**:

- 画像を選択すると「対応していない形式です」と表示される

**原因**:

- サポートされていない画像形式
- ファイルが破損している
- 拡張子が正しくない

**解決方法**:

1. **対応形式を確認**
   - 対応: PNG、JPEG、BMP、GIF、TIFF、WebP
   - 非対応: SVG、PSD、AI、EPS、RAW

2. **形式を変換**
   - 画像編集ソフトで対応形式に変換
   - 推奨: PNG形式

3. **ファイルの修復**
   - 画像編集ソフトで開いて再保存
   - オンライン画像修復ツールを使用

### 問題: 「画像が破損しています」

**症状**:

- 変換中にエラーが発生する

**原因**:

- ファイルが不完全
- ファイルヘッダーが破損
- ダウンロードエラー

**解決方法**:

1. **ファイルの再ダウンロード**
   - 元のソースから再度ダウンロード

2. **画像編集ソフトで修復**
   - Photoshop、GIMP、Paint.NETなどで開く
   - 「名前を付けて保存」で再保存

3. **オンライン修復ツール**
   - OfficeRecovery Online
   - Pixrecovery

### 問題: 変換結果が期待と異なる

#### 透明部分が白くなる

**原因**:

- 「透明度保持」が無効になっている

**解決方法**:

- 「透明度保持」オプションを有効化
- PNG、GIF、WebP形式を使用

#### 背景が透明にならない

**原因**:

- 「自動背景透明化」が無効
- 背景が複雑（グラデーション、パターン）

**解決方法**:

1. 「自動背景透明化」オプションを有効化
2. 画像編集ソフトで背景を単色に変更
3. 手動で背景を透明化してからPNG形式で保存

#### 画像が粗い・ぼやける

**原因**:

- 元の画像サイズが小さい
- リサイズアルゴリズムの限界

**解決方法**:

1. より高解像度の元画像を使用（推奨: 512×512以上）
2. ベクター形式（SVG）から高解像度のPNGを生成
3. 画像編集ソフトでシャープネスを調整

#### 色が変わる

**原因**:

- 色空間の変換
- ICO形式の制限

**解決方法**:

1. sRGB色空間の画像を使用
2. 画像編集ソフトで色を調整
3. 元の画像の色プロファイルを確認

---

## パフォーマンス問題

### 問題: 変換が遅い

**症状**:

- 変換に30秒以上かかる

**原因**:

- 大きな画像ファイル
- 低スペックPC
- バックグラウンドプロセスの負荷

**解決方法**:

1. **画像サイズを縮小**
   - 推奨: 1024×1024以下
   - 最大: 2048×2048

2. **他のアプリケーションを閉じる**
   - メモリとCPUリソースを解放

3. **PCを再起動**
   - メモリリークの解消

4. **パフォーマンス統計を確認**
   - 設定 → 詳細 → パフォーマンス統計
   - メモリ使用量、CPU使用量を確認

### 問題: メモリ不足エラー

**症状**:

- 「メモリが不足しています」と表示される
- アプリがクラッシュする

**原因**:

- 利用可能なメモリが不足
- メモリリーク

**解決方法**:

1. **他のアプリケーションを閉じる**
   - ブラウザ、動画編集ソフトなど

2. **画像サイズを縮小**
   - 5MB以下に縮小

3. **アプリを再起動**
   - メモリをクリア

4. **システムメモリを増設**
   - 推奨: 8GB以上

### 問題: CPUファンが回る

**症状**:

- 変換中にCPUファンが高速回転する
- PCが熱くなる

**原因**:

- CPU使用率が高い
- 大きな画像の処理

**解決方法**:

1. **正常な動作**
   - 変換中は一時的にCPU使用率が上がります
   - 変換完了後は正常に戻ります

2. **冷却の改善**
   - PCの通気口を清掃
   - 冷却パッドを使用（ノートPC）

3. **バックグラウンドプロセスを確認**
   - タスクマネージャー（Windows）
   - アクティビティモニタ（macOS）
   - System Monitor（Linux）

---

## ファイル関連付け

### 問題: 右クリックメニューに「ICOに変換」が表示されない

#### Windows

**原因**:

- ファイル関連付けが無効
- レジストリ設定の問題

**解決方法**:

1. **設定を確認**

   ```
   IconConverter
   → 設定
   → ファイル関連付け
   → 有効化
   ```

2. **管理者として実行**
   - IconConverterを管理者として実行
   - 設定でファイル関連付けを有効化

3. **レジストリの手動設定**（上級者向け）

   ```
   HKEY_CURRENT_USER\Software\Classes\.png\shell\ConvertToICO
   ```

   このキーが存在するか確認

4. **エクスプローラーを再起動**

   ```
   タスクマネージャー
   → エクスプローラー
   → 再起動
   ```

#### macOS

**原因**:

- macOSではシステムレベルのコンテキストメニュー統合が制限されている

**解決方法**:

1. **Automatorサービスを使用**
   - Automatorでサービスを作成
   - 「シェルスクリプトを実行」アクションを追加
   - スクリプト: `open -a IconConverter "$@"`

2. **ドラッグ&ドロップを使用**
   - 画像ファイルをIconConverterにドラッグ&ドロップ

#### Linux

**原因**:

- .desktopファイルが正しく設定されていない

**解決方法**:

1. **設定を確認**

   ```bash
   cat ~/.local/share/applications/iconconverter.desktop
   ```

2. **手動で.desktopファイルを作成**

   ```bash
   nano ~/.local/share/applications/iconconverter.desktop
   ```

   内容:

   ```ini
   [Desktop Entry]
   Name=IconConverter
   Exec=iconconverter %f
   Type=Application
   MimeType=image/png;image/jpeg;image/bmp;image/gif;image/tiff;image/webp;
   ```

3. **データベースを更新**

   ```bash
   update-desktop-database ~/.local/share/applications/
   ```

---

## 自動更新

### 問題: 更新チェックが失敗する

**症状**:

- 「更新を確認できませんでした」と表示される

**原因**:

- インターネット接続の問題
- ファイアウォールのブロック
- GitHubへのアクセス制限

**解決方法**:

1. **インターネット接続を確認**
   - ブラウザでWebサイトにアクセスできるか確認

2. **ファイアウォール設定を確認**
   - IconConverterを許可リストに追加
   - ポート443（HTTPS）が開いているか確認

3. **プロキシ設定**
   - 設定 → ネットワーク → プロキシ設定

4. **手動で更新**
   - [GitHubリリースページ](https://github.com/yourusername/iconconverter/releases)から最新版をダウンロード

### 問題: 更新のダウンロードが失敗する

**症状**:

- 更新のダウンロード中にエラーが発生する

**原因**:

- ネットワークの不安定
- ディスク容量不足

**解決方法**:

1. **ディスク容量を確認**
   - 最低500MBの空き容量が必要

2. **ネットワークを確認**
   - 安定したWi-Fi接続を使用
   - 有線LANを使用

3. **手動で更新**
   - 最新版を手動でダウンロードしてインストール

### 問題: 更新後にアプリが起動しない

**症状**:

- 更新後、アプリが起動しなくなった

**原因**:

- 更新の失敗
- 設定ファイルの互換性問題

**解決方法**:

1. **アプリを再インストール**
   - 最新版を手動でダウンロード
   - クリーンインストール

2. **設定ファイルを削除**
   - Windows: `%AppData%\IconConverter`
   - macOS: `~/Library/Application Support/IconConverter`
   - Linux: `~/.config/IconConverter`

3. **前のバージョンに戻す**
   - [GitHubリリースページ](https://github.com/yourusername/iconconverter/releases)から前のバージョンをダウンロード

---

## システムトレイ

### 問題: トレイアイコンが表示されない

#### Windows

**原因**:

- タスクバーの設定
- アプリの設定

**解決方法**:

1. **タスクバー設定を確認**

   ```
   設定
   → 個人用設定
   → タスクバー
   → 通知領域
   → タスクバーに表示するアイコンを選択
   → IconConverter: オン
   ```

2. **アプリ設定を確認**

   ```
   IconConverter
   → 設定
   → 一般
   → システムトレイを使用: 有効
   ```

#### macOS

**原因**:

- メニューバーの制限

**解決方法**:

- macOSではシステムトレイではなく、メニューバーに表示されます
- メニューバーの右側を確認

#### Linux

**原因**:

- デスクトップ環境がシステムトレイをサポートしていない

**解決方法**:

1. **システムトレイ拡張をインストール**
   - GNOME: TopIcons Plus拡張
   - KDE: デフォルトでサポート

2. **代替方法**
   - ドックにピン留め
   - アプリケーションメニューから起動

---

## ログとデバッグ

### ログファイルの場所

#### Windows

```
%AppData%\IconConverter\logs\
```

#### macOS

```
~/Library/Logs/IconConverter/
```

#### Linux

```
~/.local/share/IconConverter/logs/
```

### ログの確認方法

1. **ログファイルを開く**
   - `main.log`: メインプロセスのログ
   - `renderer.log`: レンダラープロセスのログ
   - `error.log`: エラーログ

2. **ログレベル**
   - `ERROR`: エラー
   - `WARN`: 警告
   - `INFO`: 情報
   - `DEBUG`: デバッグ情報

### デバッグモードの有効化

1. **設定からデバッグモードを有効化**

   ```
   設定
   → 詳細
   → デバッグモード: 有効
   ```

2. **開発者ツールを開く**
   - Windows/Linux: `Ctrl + Shift + I`
   - macOS: `Cmd + Option + I`

3. **コンソールでエラーを確認**
   - Consoleタブでエラーメッセージを確認

### バグレポートの作成

問題を報告する際は、以下の情報を含めてください:

1. **システム情報**
   - OS: Windows 11 / macOS 13 / Ubuntu 22.04
   - アーキテクチャ: x64 / arm64
   - IconConverterバージョン: 1.0.0

2. **問題の詳細**
   - 症状
   - 再現手順
   - 期待される動作
   - 実際の動作

3. **ログファイル**
   - `main.log`
   - `error.log`

4. **スクリーンショット**
   - エラーメッセージ
   - 問題が発生している画面

---

## 既知の問題

### Windows

1. **Windows 11でのコンテキストメニュー**
   - Windows 11の新しいコンテキストメニューでは「その他のオプションを表示」をクリックする必要があります
   - 回避策: レジストリ設定で従来のコンテキストメニューを有効化

2. **高DPI環境でのUI**
   - 一部のUIが正しくスケーリングされない場合があります
   - 回避策: 互換性設定で「高DPIスケーリングの動作を上書きします」を有効化

### macOS

1. **Apple Silicon Macでのパフォーマンス**
   - Intel版（x64）をRosetta 2で実行すると遅くなります
   - 解決策: Apple Silicon版（arm64）を使用

2. **macOS 13以降でのファイルアクセス**
   - 初回起動時にファイルアクセス権限の確認ダイアログが表示されます
   - 「許可」を選択してください

### Linux

1. **Waylandでのドラッグ&ドロップ**
   - Waylandセッションでは一部のドラッグ&ドロップが動作しない場合があります
   - 回避策: X11セッションを使用

2. **AppImageでのテーマ**
   - システムテーマが正しく適用されない場合があります
   - 回避策: DEBまたはRPMパッケージを使用

---

## サポート

問題が解決しない場合:

1. **GitHubイシュー**: [https://github.com/yourusername/iconconverter/issues](https://github.com/yourusername/iconconverter/issues)
2. **ユーザーマニュアル**: [USER_MANUAL.md](USER_MANUAL.md)
3. **インストールガイド**: [INSTALLATION.md](INSTALLATION.md)

バグレポートを作成する際は、以下のテンプレートを使用してください:

```markdown
## 環境
- OS: [Windows 11 / macOS 13 / Ubuntu 22.04]
- IconConverterバージョン: [1.0.0]
- アーキテクチャ: [x64 / arm64]

## 問題の説明
[問題の詳細な説明]

## 再現手順
1. [手順1]
2. [手順2]
3. [手順3]

## 期待される動作
[期待される動作]

## 実際の動作
[実際の動作]

## ログ
[ログファイルの内容]

## スクリーンショット
[スクリーンショット]
```

---

**最終更新**: 2024年11月
